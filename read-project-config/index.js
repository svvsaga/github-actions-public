var Ye=Object.create;var B=Object.defineProperty,Qe=Object.defineProperties,We=Object.getOwnPropertyDescriptor,Xe=Object.getOwnPropertyDescriptors,Ze=Object.getOwnPropertyNames,L=Object.getOwnPropertySymbols,He=Object.getPrototypeOf,X=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var ae=(e,t,r)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,U=(e,t)=>{for(var r in t||(t={}))X.call(t,r)&&ae(e,r,t[r]);if(L)for(var r of L(t))ie.call(t,r)&&ae(e,r,t[r]);return e},k=(e,t)=>Qe(e,Xe(t)),et=e=>B(e,"__esModule",{value:!0});var ue=(e,t)=>{var r={};for(var n in e)X.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&L)for(var n of L(e))t.indexOf(n)<0&&ie.call(e,n)&&(r[n]=e[n]);return r};var w=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var tt=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Ze(t))!X.call(e,s)&&(r||s!=="default")&&B(e,s,{get:()=>t[s],enumerable:!(n=We(t,s))||n.enumerable});return e},A=(e,t)=>tt(et(B(e!=null?Ye(He(e)):{},"default",!t&&e&&e.__esModule?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var $=w(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});P.toCommandProperties=P.toCommandValue=void 0;function rt(e){return e==null?"":typeof e=="string"||e instanceof String?e:JSON.stringify(e)}P.toCommandValue=rt;function nt(e){return Object.keys(e).length?{title:e.title,file:e.file,line:e.startLine,endLine:e.endLine,col:e.startColumn,endColumn:e.endColumn}:{}}P.toCommandProperties=nt});var he=w(y=>{"use strict";var st=y&&y.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),ot=y&&y.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),it=y&&y.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&st(t,e,r);return ot(t,e),t};Object.defineProperty(y,"__esModule",{value:!0});y.issue=y.issueCommand=void 0;var at=it(require("os")),ce=$();function le(e,t,r){let n=new pe(e,t,r);process.stdout.write(n.toString()+at.EOL)}y.issueCommand=le;function ut(e,t=""){le(e,{},t)}y.issue=ut;var fe="::",pe=class{constructor(t,r,n){t||(t="missing.command"),this.command=t,this.properties=r,this.message=n}toString(){let t=fe+this.command;if(this.properties&&Object.keys(this.properties).length>0){t+=" ";let r=!0;for(let n in this.properties)if(this.properties.hasOwnProperty(n)){let s=this.properties[n];s&&(r?r=!1:t+=",",t+=`${n}=${lt(s)}`)}}return t+=`${fe}${ct(this.message)}`,t}};function ct(e){return ce.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}function lt(e){return ce.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}});var ge=w(S=>{"use strict";var ft=S&&S.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),pt=S&&S.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),de=S&&S.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&ft(t,e,r);return pt(t,e),t};Object.defineProperty(S,"__esModule",{value:!0});S.issueCommand=void 0;var me=de(require("fs")),ht=de(require("os")),dt=$();function mt(e,t){let r=process.env[`GITHUB_${e}`];if(!r)throw new Error(`Unable to find environment variable for file command ${e}`);if(!me.existsSync(r))throw new Error(`Missing file at path: ${r}`);me.appendFileSync(r,`${dt.toCommandValue(t)}${ht.EOL}`,{encoding:"utf8"})}S.issueCommand=mt});var ve=w(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});function gt(e){let t=e.protocol==="https:",r;if(ye(e))return r;let n;return t?n=process.env.https_proxy||process.env.HTTPS_PROXY:n=process.env.http_proxy||process.env.HTTP_PROXY,n&&(r=new URL(n)),r}F.getProxyUrl=gt;function ye(e){if(!e.hostname)return!1;let t=process.env.no_proxy||process.env.NO_PROXY||"";if(!t)return!1;let r;e.port?r=Number(e.port):e.protocol==="http:"?r=80:e.protocol==="https:"&&(r=443);let n=[e.hostname.toUpperCase()];typeof r=="number"&&n.push(`${n[0]}:${r}`);for(let s of t.split(",").map(o=>o.trim().toUpperCase()).filter(o=>o))if(n.some(o=>o===s))return!0;return!1}F.checkBypass=ye});var Oe=w(q=>{"use strict";var pr=require("net"),yt=require("tls"),Z=require("http"),_e=require("https"),vt=require("events"),hr=require("assert"),_t=require("util");q.httpOverHttp=wt;q.httpsOverHttp=St;q.httpOverHttps=Ot;q.httpsOverHttps=bt;function wt(e){var t=new O(e);return t.request=Z.request,t}function St(e){var t=new O(e);return t.request=Z.request,t.createSocket=we,t.defaultPort=443,t}function Ot(e){var t=new O(e);return t.request=_e.request,t}function bt(e){var t=new O(e);return t.request=_e.request,t.createSocket=we,t.defaultPort=443,t}function O(e){var t=this;t.options=e||{},t.proxyOptions=t.options.proxy||{},t.maxSockets=t.options.maxSockets||Z.Agent.defaultMaxSockets,t.requests=[],t.sockets=[],t.on("free",function(n,s,o,a){for(var i=Se(s,o,a),c=0,u=t.requests.length;c<u;++c){var f=t.requests[c];if(f.host===i.host&&f.port===i.port){t.requests.splice(c,1),f.request.onSocket(n);return}}n.destroy(),t.removeSocket(n)})}_t.inherits(O,vt.EventEmitter);O.prototype.addRequest=function(t,r,n,s){var o=this,a=H({request:t},o.options,Se(r,n,s));if(o.sockets.length>=this.maxSockets){o.requests.push(a);return}o.createSocket(a,function(i){i.on("free",c),i.on("close",u),i.on("agentRemove",u),t.onSocket(i);function c(){o.emit("free",i,a)}function u(f){o.removeSocket(i),i.removeListener("free",c),i.removeListener("close",u),i.removeListener("agentRemove",u)}})};O.prototype.createSocket=function(t,r){var n=this,s={};n.sockets.push(s);var o=H({},n.proxyOptions,{method:"CONNECT",path:t.host+":"+t.port,agent:!1,headers:{host:t.host+":"+t.port}});t.localAddress&&(o.localAddress=t.localAddress),o.proxyAuth&&(o.headers=o.headers||{},o.headers["Proxy-Authorization"]="Basic "+new Buffer(o.proxyAuth).toString("base64")),b("making CONNECT request");var a=n.request(o);a.useChunkedEncodingByDefault=!1,a.once("response",i),a.once("upgrade",c),a.once("connect",u),a.once("error",f),a.end();function i(p){p.upgrade=!0}function c(p,h,R){process.nextTick(function(){u(p,h,R)})}function u(p,h,R){if(a.removeAllListeners(),h.removeAllListeners(),p.statusCode!==200){b("tunneling socket could not be established, statusCode=%d",p.statusCode),h.destroy();var C=new Error("tunneling socket could not be established, statusCode="+p.statusCode);C.code="ECONNRESET",t.request.emit("error",C),n.removeSocket(s);return}if(R.length>0){b("got illegal response body from proxy"),h.destroy();var C=new Error("got illegal response body from proxy");C.code="ECONNRESET",t.request.emit("error",C),n.removeSocket(s);return}return b("tunneling connection has established"),n.sockets[n.sockets.indexOf(s)]=h,r(h)}function f(p){a.removeAllListeners(),b(`tunneling socket could not be established, cause=%s
`,p.message,p.stack);var h=new Error("tunneling socket could not be established, cause="+p.message);h.code="ECONNRESET",t.request.emit("error",h),n.removeSocket(s)}};O.prototype.removeSocket=function(t){var r=this.sockets.indexOf(t);if(r!==-1){this.sockets.splice(r,1);var n=this.requests.shift();n&&this.createSocket(n,function(s){n.request.onSocket(s)})}};function we(e,t){var r=this;O.prototype.createSocket.call(r,e,function(n){var s=e.request.getHeader("host"),o=H({},r.options,{socket:n,servername:s?s.replace(/:.*$/,""):e.host}),a=yt.connect(0,o);r.sockets[r.sockets.indexOf(n)]=a,t(a)})}function Se(e,t,r){return typeof e=="string"?{host:e,port:t,localAddress:r}:e}function H(e){for(var t=1,r=arguments.length;t<r;++t){var n=arguments[t];if(typeof n=="object")for(var s=Object.keys(n),o=0,a=s.length;o<a;++o){var i=s[o];n[i]!==void 0&&(e[i]=n[i])}}return e}var b;process.env.NODE_DEBUG&&/\btunnel\b/.test(process.env.NODE_DEBUG)?b=function(){var e=Array.prototype.slice.call(arguments);typeof e[0]=="string"?e[0]="TUNNEL: "+e[0]:e.unshift("TUNNEL:"),console.error.apply(console,e)}:b=function(){};q.debug=b});var Ee=w((mr,be)=>{be.exports=Oe()});var Re=w(m=>{"use strict";Object.defineProperty(m,"__esModule",{value:!0});var G=require("http"),ee=require("https"),Te=ve(),x,_;(function(e){e[e.OK=200]="OK",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.ResourceMoved=302]="ResourceMoved",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.SwitchProxy=306]="SwitchProxy",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.TooManyRequests=429]="TooManyRequests",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout"})(_=m.HttpCodes||(m.HttpCodes={}));var d;(function(e){e.Accept="accept",e.ContentType="content-type"})(d=m.Headers||(m.Headers={}));var E;(function(e){e.ApplicationJson="application/json"})(E=m.MediaTypes||(m.MediaTypes={}));function Et(e){let t=Te.getProxyUrl(new URL(e));return t?t.href:""}m.getProxyUrl=Et;var Tt=[_.MovedPermanently,_.ResourceMoved,_.SeeOther,_.TemporaryRedirect,_.PermanentRedirect],Rt=[_.BadGateway,_.ServiceUnavailable,_.GatewayTimeout],At=["OPTIONS","GET","DELETE","HEAD"],Pt=10,qt=5,j=class extends Error{constructor(t,r){super(t);this.name="HttpClientError",this.statusCode=r,Object.setPrototypeOf(this,j.prototype)}};m.HttpClientError=j;var te=class{constructor(t){this.message=t}readBody(){return new Promise(async(t,r)=>{let n=Buffer.alloc(0);this.message.on("data",s=>{n=Buffer.concat([n,s])}),this.message.on("end",()=>{t(n.toString())})})}};m.HttpClientResponse=te;function xt(e){return new URL(e).protocol==="https:"}m.isHttps=xt;var J=class{constructor(t,r,n){this._ignoreSslError=!1,this._allowRedirects=!0,this._allowRedirectDowngrade=!1,this._maxRedirects=50,this._allowRetries=!1,this._maxRetries=1,this._keepAlive=!1,this._disposed=!1,this.userAgent=t,this.handlers=r||[],this.requestOptions=n,n&&(n.ignoreSslError!=null&&(this._ignoreSslError=n.ignoreSslError),this._socketTimeout=n.socketTimeout,n.allowRedirects!=null&&(this._allowRedirects=n.allowRedirects),n.allowRedirectDowngrade!=null&&(this._allowRedirectDowngrade=n.allowRedirectDowngrade),n.maxRedirects!=null&&(this._maxRedirects=Math.max(n.maxRedirects,0)),n.keepAlive!=null&&(this._keepAlive=n.keepAlive),n.allowRetries!=null&&(this._allowRetries=n.allowRetries),n.maxRetries!=null&&(this._maxRetries=n.maxRetries))}options(t,r){return this.request("OPTIONS",t,null,r||{})}get(t,r){return this.request("GET",t,null,r||{})}del(t,r){return this.request("DELETE",t,null,r||{})}post(t,r,n){return this.request("POST",t,r,n||{})}patch(t,r,n){return this.request("PATCH",t,r,n||{})}put(t,r,n){return this.request("PUT",t,r,n||{})}head(t,r){return this.request("HEAD",t,null,r||{})}sendStream(t,r,n,s){return this.request(t,r,n,s)}async getJson(t,r={}){r[d.Accept]=this._getExistingOrDefaultHeader(r,d.Accept,E.ApplicationJson);let n=await this.get(t,r);return this._processResponse(n,this.requestOptions)}async postJson(t,r,n={}){let s=JSON.stringify(r,null,2);n[d.Accept]=this._getExistingOrDefaultHeader(n,d.Accept,E.ApplicationJson),n[d.ContentType]=this._getExistingOrDefaultHeader(n,d.ContentType,E.ApplicationJson);let o=await this.post(t,s,n);return this._processResponse(o,this.requestOptions)}async putJson(t,r,n={}){let s=JSON.stringify(r,null,2);n[d.Accept]=this._getExistingOrDefaultHeader(n,d.Accept,E.ApplicationJson),n[d.ContentType]=this._getExistingOrDefaultHeader(n,d.ContentType,E.ApplicationJson);let o=await this.put(t,s,n);return this._processResponse(o,this.requestOptions)}async patchJson(t,r,n={}){let s=JSON.stringify(r,null,2);n[d.Accept]=this._getExistingOrDefaultHeader(n,d.Accept,E.ApplicationJson),n[d.ContentType]=this._getExistingOrDefaultHeader(n,d.ContentType,E.ApplicationJson);let o=await this.patch(t,s,n);return this._processResponse(o,this.requestOptions)}async request(t,r,n,s){if(this._disposed)throw new Error("Client has already been disposed.");let o=new URL(r),a=this._prepareRequest(t,o,s),i=this._allowRetries&&At.indexOf(t)!=-1?this._maxRetries+1:1,c=0,u;for(;c<i;){if(u=await this.requestRaw(a,n),u&&u.message&&u.message.statusCode===_.Unauthorized){let p;for(let h=0;h<this.handlers.length;h++)if(this.handlers[h].canHandleAuthentication(u)){p=this.handlers[h];break}return p?p.handleAuthentication(this,a,n):u}let f=this._maxRedirects;for(;Tt.indexOf(u.message.statusCode)!=-1&&this._allowRedirects&&f>0;){let p=u.message.headers.location;if(!p)break;let h=new URL(p);if(o.protocol=="https:"&&o.protocol!=h.protocol&&!this._allowRedirectDowngrade)throw new Error("Redirect from HTTPS to HTTP protocol. This downgrade is not allowed for security reasons. If you want to allow this behavior, set the allowRedirectDowngrade option to true.");if(await u.readBody(),h.hostname!==o.hostname)for(let R in s)R.toLowerCase()==="authorization"&&delete s[R];a=this._prepareRequest(t,h,s),u=await this.requestRaw(a,n),f--}if(Rt.indexOf(u.message.statusCode)==-1)return u;c+=1,c<i&&(await u.readBody(),await this._performExponentialBackoff(c))}return u}dispose(){this._agent&&this._agent.destroy(),this._disposed=!0}requestRaw(t,r){return new Promise((n,s)=>{let o=function(a,i){a&&s(a),n(i)};this.requestRawWithCallback(t,r,o)})}requestRawWithCallback(t,r,n){let s;typeof r=="string"&&(t.options.headers["Content-Length"]=Buffer.byteLength(r,"utf8"));let o=!1,a=(c,u)=>{o||(o=!0,n(c,u))},i=t.httpModule.request(t.options,c=>{let u=new te(c);a(null,u)});i.on("socket",c=>{s=c}),i.setTimeout(this._socketTimeout||3*6e4,()=>{s&&s.end(),a(new Error("Request timeout: "+t.options.path),null)}),i.on("error",function(c){a(c,null)}),r&&typeof r=="string"&&i.write(r,"utf8"),r&&typeof r!="string"?(r.on("close",function(){i.end()}),r.pipe(i)):i.end()}getAgent(t){let r=new URL(t);return this._getAgent(r)}_prepareRequest(t,r,n){let s={};s.parsedUrl=r;let o=s.parsedUrl.protocol==="https:";s.httpModule=o?ee:G;let a=o?443:80;return s.options={},s.options.host=s.parsedUrl.hostname,s.options.port=s.parsedUrl.port?parseInt(s.parsedUrl.port):a,s.options.path=(s.parsedUrl.pathname||"")+(s.parsedUrl.search||""),s.options.method=t,s.options.headers=this._mergeHeaders(n),this.userAgent!=null&&(s.options.headers["user-agent"]=this.userAgent),s.options.agent=this._getAgent(s.parsedUrl),this.handlers&&this.handlers.forEach(i=>{i.prepareRequest(s.options)}),s}_mergeHeaders(t){let r=n=>Object.keys(n).reduce((s,o)=>(s[o.toLowerCase()]=n[o],s),{});return this.requestOptions&&this.requestOptions.headers?Object.assign({},r(this.requestOptions.headers),r(t)):r(t||{})}_getExistingOrDefaultHeader(t,r,n){let s=a=>Object.keys(a).reduce((i,c)=>(i[c.toLowerCase()]=a[c],i),{}),o;return this.requestOptions&&this.requestOptions.headers&&(o=s(this.requestOptions.headers)[r]),t[r]||o||n}_getAgent(t){let r,n=Te.getProxyUrl(t),s=n&&n.hostname;if(this._keepAlive&&s&&(r=this._proxyAgent),this._keepAlive&&!s&&(r=this._agent),r)return r;let o=t.protocol==="https:",a=100;if(this.requestOptions&&(a=this.requestOptions.maxSockets||G.globalAgent.maxSockets),s){x||(x=Ee());let i={maxSockets:a,keepAlive:this._keepAlive,proxy:k(U({},(n.username||n.password)&&{proxyAuth:`${n.username}:${n.password}`}),{host:n.hostname,port:n.port})},c,u=n.protocol==="https:";o?c=u?x.httpsOverHttps:x.httpsOverHttp:c=u?x.httpOverHttps:x.httpOverHttp,r=c(i),this._proxyAgent=r}if(this._keepAlive&&!r){let i={keepAlive:this._keepAlive,maxSockets:a};r=o?new ee.Agent(i):new G.Agent(i),this._agent=r}return r||(r=o?ee.globalAgent:G.globalAgent),o&&this._ignoreSslError&&(r.options=Object.assign(r.options||{},{rejectUnauthorized:!1})),r}_performExponentialBackoff(t){t=Math.min(Pt,t);let r=qt*Math.pow(2,t);return new Promise(n=>setTimeout(()=>n(),r))}static dateTimeDeserializer(t,r){if(typeof r=="string"){let n=new Date(r);if(!isNaN(n.valueOf()))return n}return r}async _processResponse(t,r){return new Promise(async(n,s)=>{let o=t.message.statusCode,a={statusCode:o,result:null,headers:{}};o==_.NotFound&&n(a);let i,c;try{c=await t.readBody(),c&&c.length>0&&(r&&r.deserializeDates?i=JSON.parse(c,J.dateTimeDeserializer):i=JSON.parse(c),a.result=i),a.headers=t.message.headers}catch{}if(o>299){let u;i&&i.message?u=i.message:c&&c.length>0?u=c:u="Failed request: ("+o+")";let f=new j(u,o);f.result=a.result,s(f)}else n(a)})}};m.HttpClient=J});var xe=w(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});var Ae=class{constructor(t,r){this.username=t,this.password=r}prepareRequest(t){t.headers.Authorization="Basic "+Buffer.from(this.username+":"+this.password).toString("base64")}canHandleAuthentication(t){return!1}handleAuthentication(t,r,n){return null}};D.BasicCredentialHandler=Ae;var Pe=class{constructor(t){this.token=t}prepareRequest(t){t.headers.Authorization="Bearer "+this.token}canHandleAuthentication(t){return!1}handleAuthentication(t,r,n){return null}};D.BearerCredentialHandler=Pe;var qe=class{constructor(t){this.token=t}prepareRequest(t){t.headers.Authorization="Basic "+Buffer.from("PAT:"+this.token).toString("base64")}canHandleAuthentication(t){return!1}handleAuthentication(t,r,n){return null}};D.PersonalAccessTokenCredentialHandler=qe});var Ce=w(I=>{"use strict";var Ie=I&&I.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function i(f){try{u(n.next(f))}catch(p){a(p)}}function c(f){try{u(n.throw(f))}catch(p){a(p)}}function u(f){f.done?o(f.value):s(f.value).then(i,c)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(I,"__esModule",{value:!0});I.OidcClient=void 0;var It=Re(),Nt=xe(),Ne=V(),T=class{static createHttpClient(t=!0,r=10){let n={allowRetries:t,maxRetries:r};return new It.HttpClient("actions/oidc-client",[new Nt.BearerCredentialHandler(T.getRequestToken())],n)}static getRequestToken(){let t=process.env.ACTIONS_ID_TOKEN_REQUEST_TOKEN;if(!t)throw new Error("Unable to get ACTIONS_ID_TOKEN_REQUEST_TOKEN env variable");return t}static getIDTokenUrl(){let t=process.env.ACTIONS_ID_TOKEN_REQUEST_URL;if(!t)throw new Error("Unable to get ACTIONS_ID_TOKEN_REQUEST_URL env variable");return t}static getCall(t){var r;return Ie(this,void 0,void 0,function*(){let o=(r=(yield T.createHttpClient().getJson(t).catch(a=>{throw new Error(`Failed to get ID Token. 
 
        Error Code : ${a.statusCode}
 
        Error Message: ${a.result.message}`)})).result)===null||r===void 0?void 0:r.value;if(!o)throw new Error("Response json body do not have ID Token field");return o})}static getIDToken(t){return Ie(this,void 0,void 0,function*(){try{let r=T.getIDTokenUrl();if(t){let s=encodeURIComponent(t);r=`${r}&audience=${s}`}Ne.debug(`ID token url is ${r}`);let n=yield T.getCall(r);return Ne.setSecret(n),n}catch(r){throw new Error(`Error message: ${r.message}`)}})}};I.OidcClient=T});var V=w(l=>{"use strict";var Ct=l&&l.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Ut=l&&l.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Ue=l&&l.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&Ct(t,e,r);return Ut(t,e),t},ke=l&&l.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function i(f){try{u(n.next(f))}catch(p){a(p)}}function c(f){try{u(n.throw(f))}catch(p){a(p)}}function u(f){f.done?o(f.value):s(f.value).then(i,c)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(l,"__esModule",{value:!0});l.getIDToken=l.getState=l.saveState=l.group=l.endGroup=l.startGroup=l.info=l.notice=l.warning=l.error=l.debug=l.isDebug=l.setFailed=l.setCommandEcho=l.setOutput=l.getBooleanInput=l.getMultilineInput=l.getInput=l.addPath=l.setSecret=l.exportVariable=l.ExitCode=void 0;var v=he(),je=ge(),z=$(),K=Ue(require("os")),kt=Ue(require("path")),jt=Ce(),De;(function(e){e[e.Success=0]="Success",e[e.Failure=1]="Failure"})(De=l.ExitCode||(l.ExitCode={}));function Dt(e,t){let r=z.toCommandValue(t);if(process.env[e]=r,process.env.GITHUB_ENV||""){let s="_GitHubActionsFileCommandDelimeter_",o=`${e}<<${s}${K.EOL}${r}${K.EOL}${s}`;je.issueCommand("ENV",o)}else v.issueCommand("set-env",{name:e},r)}l.exportVariable=Dt;function Mt(e){v.issueCommand("add-mask",{},e)}l.setSecret=Mt;function Bt(e){process.env.GITHUB_PATH||""?je.issueCommand("PATH",e):v.issueCommand("add-path",{},e),process.env.PATH=`${e}${kt.delimiter}${process.env.PATH}`}l.addPath=Bt;function re(e,t){let r=process.env[`INPUT_${e.replace(/ /g,"_").toUpperCase()}`]||"";if(t&&t.required&&!r)throw new Error(`Input required and not supplied: ${e}`);return t&&t.trimWhitespace===!1?r:r.trim()}l.getInput=re;function Lt(e,t){return re(e,t).split(`
`).filter(n=>n!=="")}l.getMultilineInput=Lt;function $t(e,t){let r=["true","True","TRUE"],n=["false","False","FALSE"],s=re(e,t);if(r.includes(s))return!0;if(n.includes(s))return!1;throw new TypeError(`Input does not meet YAML 1.2 "Core Schema" specification: ${e}
Support boolean input list: \`true | True | TRUE | false | False | FALSE\``)}l.getBooleanInput=$t;function Ft(e,t){process.stdout.write(K.EOL),v.issueCommand("set-output",{name:e},t)}l.setOutput=Ft;function Gt(e){v.issue("echo",e?"on":"off")}l.setCommandEcho=Gt;function Jt(e){process.exitCode=De.Failure,Me(e)}l.setFailed=Jt;function Vt(){return process.env.RUNNER_DEBUG==="1"}l.isDebug=Vt;function zt(e){v.issueCommand("debug",{},e)}l.debug=zt;function Me(e,t={}){v.issueCommand("error",z.toCommandProperties(t),e instanceof Error?e.toString():e)}l.error=Me;function Kt(e,t={}){v.issueCommand("warning",z.toCommandProperties(t),e instanceof Error?e.toString():e)}l.warning=Kt;function Yt(e,t={}){v.issueCommand("notice",z.toCommandProperties(t),e instanceof Error?e.toString():e)}l.notice=Yt;function Qt(e){process.stdout.write(e+K.EOL)}l.info=Qt;function Be(e){v.issue("group",e)}l.startGroup=Be;function Le(){v.issue("endgroup")}l.endGroup=Le;function Wt(e,t){return ke(this,void 0,void 0,function*(){Be(e);let r;try{r=yield t()}finally{Le()}return r})}l.group=Wt;function Xt(e,t){v.issueCommand("save-state",{name:e},t)}l.saveState=Xt;function Zt(e){return process.env[`STATE_${e}`]||""}l.getState=Zt;function Ht(e){return ke(this,void 0,void 0,function*(){return yield jt.OidcClient.getIDToken(e)})}l.getIDToken=Ht});var g=A(V());var N=A(require("node:path"),1);var Fe=A(require("node:process"),1),Ge=A(require("node:path"),1),W=A(require("node:fs"),1);var $e=class{value;next;constructor(t){this.value=t}},Y=class{#e;#t;#r;constructor(){this.clear()}enqueue(t){let r=new $e(t);this.#e?(this.#t.next=r,this.#t=r):(this.#e=r,this.#t=r),this.#r++}dequeue(){let t=this.#e;if(!!t)return this.#e=this.#e.next,this.#r--,t.value}clear(){this.#e=void 0,this.#t=void 0,this.#r=0}get size(){return this.#r}*[Symbol.iterator](){let t=this.#e;for(;t;)yield t.value,t=t.next}};function Q(e){if(!((Number.isInteger(e)||e===Number.POSITIVE_INFINITY)&&e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");let t=new Y,r=0,n=()=>{r--,t.size>0&&t.dequeue()()},s=async(i,c,u)=>{r++;let f=(async()=>i(...u))();c(f);try{await f}catch{}n()},o=(i,c,u)=>{t.enqueue(s.bind(void 0,i,c,u)),(async()=>(await Promise.resolve(),r<e&&t.size>0&&t.dequeue()()))()},a=(i,...c)=>new Promise(u=>{o(i,u,c)});return Object.defineProperties(a,{activeCount:{get:()=>r},pendingCount:{get:()=>t.size},clearQueue:{value:()=>{t.clear()}}}),a}var ne=class extends Error{constructor(t){super();this.value=t}},er=async(e,t)=>t(await e),tr=async e=>{let t=await Promise.all(e);if(t[1]===!0)throw new ne(t[0]);return!1};async function se(e,t,{concurrency:r=Number.POSITIVE_INFINITY,preserveOrder:n=!0}={}){let s=Q(r),o=[...e].map(i=>[i,s(er,i,t)]),a=Q(n?1:Number.POSITIVE_INFINITY);try{await Promise.all(o.map(i=>a(tr,i)))}catch(i){if(i instanceof ne)return i.value;throw i}}var Je={directory:"isDirectory",file:"isFile"};function rr(e){if(!(e in Je))throw new Error(`Invalid type specified: ${e}`)}var nr=(e,t)=>e===void 0||t[Je[e]]();async function oe(e,{cwd:t=Fe.default.cwd(),type:r="file",allowSymlinks:n=!0,concurrency:s,preserveOrder:o}={}){rr(r);let a=n?W.promises.stat:W.promises.lstat;return se(e,async i=>{try{let c=await a(Ge.default.resolve(t,i));return nr(r,c)}catch{return!1}},{concurrency:s,preserveOrder:o})}var sr=Symbol("findUpStop");async function or(e,t={}){let r=N.default.resolve(t.cwd||""),{root:n}=N.default.parse(r),s=N.default.resolve(r,t.stopAt||n),o=t.limit||Number.POSITIVE_INFINITY,a=[e].flat(),i=async u=>{if(typeof e!="function")return oe(a,u);let f=await e(u.cwd);return typeof f=="string"?oe([f],u):f},c=[];for(;;){let u=await i(k(U({},t),{cwd:r}));if(u===sr||(u&&c.push(N.default.resolve(r,u)),r===s||c.length>=o))break;r=N.default.dirname(r)}return c}async function Ve(e,t={}){return(await or(e,k(U({},t),{limit:1})))[0]}var ze=require("fs"),M=A(V());async function Ke({cwd:e,configFile:t="projects.config.json",required:r=!1}){let n=await Ve(t,{cwd:e});n?M.info(`Found config file at ${n}`):M.info(`Could not find config file ${t} in ${e}`);let s=n?(0,ze.readFileSync)(n,"utf8"):"";if(r&&!s)throw new Error(`Config file ${t} not found or empty`);try{let o=JSON.parse(s),{project_numbers:a}=o,i=ue(o,["project_numbers"]),c=Object.keys(i);return{project_numbers:a,project_ids:i,environments:c}}catch(a){return M.error(a),{project_ids:{},project_numbers:{},environments:[]}}}async function ir(){try{let e=g.getInput("cwd"),t=g.getInput("config_file"),r=g.getBooleanInput("required"),n=await Ke({cwd:e,configFile:t,required:r});g.setOutput("project_ids_by_environment",JSON.stringify(n.project_ids)),g.setOutput("project_numbers_by_environment",JSON.stringify(n.project_numbers)),g.setOutput("environments",JSON.stringify(n.environments)),g.setOutput("matrix",JSON.stringify({include:n.environments.map(s=>({environment:s,project_id:n.project_ids[s],project_number:n.project_numbers[s]}))})),g.setOutput("has_matrix",n.environments.length>0)}catch(e){g.setFailed(e)}}ir();
